<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/templates/basicTemplate.xhtml">

	<ui:define name="content">

		<h:panelGroup id="mainContainer" layout="block" styleClass="container">

			<h:panelGroup layout="block" styleClass="row">
				<h:panelGrid layout="block" width="100%" columns="1"
					columnClasses="pageTitle">
					<h:outputText value="#{msg['page.title.createarticle']}" />
				</h:panelGrid>
			</h:panelGroup>

			<h:panelGrid width="100%" style="height:40px;" />

			<h:panelGroup layout="block" styleClass="row">

				<h:panelGroup layout="block" styleClass="col-md-3">

					<h:panelGrid layout="block" columnClasses="sectionTableHeader"
						width="100%" columns="1">
						<h:outputText styleClass="sectionTableHeaderText"
							value="#{msg['page.label.menu']}" />
					</h:panelGrid>

					<h:panelGrid layout="block" width="100%" columns="1"
						columnClasses="menuTableColumn">
						<h:commandButton value="#{msg['page.label.articles']}"
							styleClass="menuButton" immediate="true"
							action="#{editArticleBean.goToArticlePage()}" />
						<h:commandButton value="#{msg['page.label.portal']}"
							styleClass="menuButton" immediate="true"
							action="#{editArticleBean.goToPortalPage()}" />
						<h:commandButton value="#{msg['page.label.profile']}"
							styleClass="menuButton" immediate="true"
							action="#{editArticleBean.goToProfilePage()}" />
					</h:panelGrid>

				</h:panelGroup>

				<h:panelGroup layout="block" styleClass="col-md-9">

					<h:panelGroup id="featureDetails" layout="block"
						styleClass="col-md-11">


						<h:panelGrid layout="block" columnClasses="sectionTableHeader"
							width="100%" columns="1">
							<h:outputText styleClass="sectionTableHeaderText"
								value="#{msg['page.label.articledetails']}" />
						</h:panelGrid>

						<h:panelGrid id="articleDetailsContainer" layout="block"
							width="100%" columns="2"
							columnClasses="featureTableLabelColumn,featureTableValueNoErrColumn">

							<h:outputLabel value="#{msg['page.label.subject']}" />
							<h:panelGrid width="100%" columns="1">
								<h:inputText id="subjectInput" label="Subject"
									rendered="#{editArticleBean.articleAllowEdit}"																						
									styleClass="textInputMaxWidth" required="true"
									value="#{editArticleBean.selectedArticle.subject}">
									<f:validateLength minimum="5" maximum="255" />
								</h:inputText>
								<h:outputText rendered="#{!editArticleBean.articleAllowEdit}"																						
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.selectedArticle.subject}"/>
								<h:message for="subjectInput" styleClass="featureErrorLabel" />
							</h:panelGrid>

							<h:outputLabel value="#{msg['page.label.shortdescription']}" />
							<h:panelGrid width="100%" columns="1">
								<h:inputTextarea id="shortDescriptionInput"
									rendered="#{editArticleBean.articleAllowEdit}"																														
									label="Short description" style="width:100%" required="true"
									cols="10" rows="2"
									value="#{editArticleBean.selectedArticle.shortDescription}">
									<f:validateLength minimum="5" maximum="2048" />
								</h:inputTextarea>
								<h:outputText
									rendered="#{!editArticleBean.articleAllowEdit}"		
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.selectedArticle.shortDescription}"/>
								<h:message for="shortDescriptionInput"
									styleClass="featureErrorLabel" />
							</h:panelGrid>


							<h:outputLabel value="#{msg['page.label.category']}" />
							<h:panelGrid width="100%" columns="1">
								<h:selectOneMenu id="categoryInput" label="Category"
									rendered="#{editArticleBean.articleAllowEdit}"																																							
									required="true"
									value="#{editArticleBean.selectedArticle.category}">
									<f:selectItem itemLabel="Select" noSelectionOption="true" />
									<f:selectItems value="#{editArticleBean.availableCategories}"
										var="cat" label="#{cat.name}" />
								</h:selectOneMenu>
								<h:outputText
									rendered="#{!editArticleBean.articleAllowEdit}"		
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.selectedArticle.category}"/>								
								<h:message for="categoryInput" styleClass="featureErrorLabel" />
							</h:panelGrid>							

						</h:panelGrid>

						<h:panelGrid id="contentValueContainer" layout="block"
							width="100%" columns="2"
							columnClasses="featureTableLabelColumn,featureTableValueNoErrColumn">
							<h:outputLabel for="contentValue"
								value="#{msg['page.label.content']}" />
							<h:panelGrid id="contentValue" width="100%" columns="1" rendered="#{editArticleBean.articleAllowEdit}">
								<h:outputText value="#{editArticleBean.selectedArticle.content}" />
							</h:panelGrid>
							<h:panelGrid id="contentDisplay" width="100%" columns="1" rendered="#{!editArticleBean.articleAllowEdit}">
								<h:outputText value="#{editArticleBean.selectedArticle.content}" />
							</h:panelGrid>							
						</h:panelGrid>

						<h:panelGrid id="contentInputContainer" layout="block"
							rendered="#{editArticleBean.articleAllowEdit}"																																													
							width="100%" columns="2"
							columnClasses="featureTableLabelColumn,featureTableValueNoErrColumn">
							<h:inputHidden required="true"
								value="#{editArticleBean.selectedArticle.content}"
								id="contentInput">
								<f:validator validatorId="articleContextValidator" />
							</h:inputHidden>
							<h:message for="contentInput" style="color:red" />
						</h:panelGrid>						

						<h:panelGrid id="imageInputContainer" layout="block" width="100%"
							columns="3"
							columnClasses="featureTableLabelColumn,featureTableValueColumn,featureTableErrorColumn">
							<h:outputLabel for="imagesTable"
								value="#{msg['page.label.images']}" />
							<h:dataTable id="imagesTable" width="100%"
								rendered="#{editArticleBean.selectedArticle.imageUrls.size()>0}"
								value="#{editArticleBean.selectedArticle.imageUrls}"
								var="imageUrl" border="0"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton">
								<h:column>
									<h:outputText value="#{imageUrl}" />
								</h:column>
								<h:column rendered="#{editArticleBean.articleAllowEdit}">
									<h:commandButton value="#{msg['page.label.delete']}" action="#{editArticleBean.deleteImage(imageUrl)}">
										<f:ajax execute="@this" render="mainForm:imageInputContainer" />
									</h:commandButton>
								</h:column>
							</h:dataTable>
							<h:message for="imagesTable"
								rendered="#{editArticleBean.selectedArticle.imageUrls.size()>0}"
								style="color:red" />
							<h:outputLabel
								rendered="#{editArticleBean.articleAllowEdit and editArticleBean.selectedArticle.imageUrls.size()>0}" />
							<h:panelGrid columns="2"
								rendered="#{editArticleBean.articleAllowEdit}"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton"
								width="100%">
								<h:inputText id="imagesInput" required="true"
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.newImageUrl}">
									<f:validator validatorId="mediaUrlValidator" />
								</h:inputText>
								<h:commandLink value="#{msg['page.label.add']}"
									action="#{editArticleBean.addImage}">									
									<f:ajax execute="imagesInput" render="imageInputContainer" />
								</h:commandLink>
							</h:panelGrid>
							<h:message for="imagesInput" rendered="#{editArticleBean.articleAllowEdit}" style="color:red" />

						</h:panelGrid>

						<h:panelGrid id="videoInputContainer" layout="block" width="100%"
							columns="3"
							columnClasses="featureTableLabelColumn,featureTableValueColumn,featureTableErrorColumn">
							<h:outputLabel for="videoTable"
								value="#{msg['page.label.video']}" />
							<h:dataTable id="videoTable" width="100%"
								rendered="#{editArticleBean.selectedArticle.videoUrls.size()>0}"
								value="#{editArticleBean.selectedArticle.videoUrls}"
								var="videoUrl" border="0"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton">
								<h:column>
									<h:outputText value="#{videoUrl}" />
								</h:column>
								<h:column rendered="#{editArticleBean.articleAllowEdit}">
									<h:commandButton value="#{msg['page.label.delete']}" action="#{editArticleBean.deleteVideo(videoUrl)}">
										<f:ajax execute="@this" render="mainForm:videoInputContainer" />									
									</h:commandButton>								
								</h:column>
							</h:dataTable>
							<h:message for="videoTable"
								rendered="#{editArticleBean.selectedArticle.videoUrls.size()>0}"
								style="color:red" />
							<h:outputLabel
								rendered="#{editArticleBean.articleAllowEdit and editArticleBean.selectedArticle.videoUrls.size()>0}" />
							<h:panelGrid columns="2"  rendered="#{editArticleBean.articleAllowEdit}"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton"
								width="100%">
								<h:inputText id="videoInput" required="true"
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.newVideoUrl}">
									<f:validator validatorId="mediaUrlValidator" />
								</h:inputText>
								<h:commandLink value="#{msg['page.label.add']}"
									action="#{editArticleBean.addVideo}">
									<f:ajax execute="videoInput" render="videoInputContainer" />
								</h:commandLink>
							</h:panelGrid>
							<h:message for="videoInput"  rendered="#{editArticleBean.articleAllowEdit}" style="color:red" />

						</h:panelGrid>

						<h:panelGrid id="audioInputContainer" layout="block" width="100%"
							columns="3"
							columnClasses="featureTableLabelColumn,featureTableValueColumn,featureTableErrorColumn">
							<h:outputLabel for="audioTable"
								value="#{msg['page.label.audio']}" />
							<h:dataTable id="audioTable" width="100%"
								rendered="#{editArticleBean.selectedArticle.audioUrls.size()>0}"
								value="#{editArticleBean.selectedArticle.audioUrls}"
								var="audioUrl" border="0"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton">
								<h:column>
									<h:outputText value="#{audioUrl}" />
								</h:column>
								<h:column rendered="#{editArticleBean.articleAllowEdit}">
									<h:commandButton value="#{msg['page.label.delete']}" action="#{editArticleBean.deleteAudio(audioUrl)}">
										<f:ajax execute="@this" render="mainForm:audioInputContainer" />									
									</h:commandButton>									
								</h:column>
							</h:dataTable>
							<h:message for="audioInput"
								rendered="#{editArticleBean.selectedArticle.audioUrls.size()>0}"
								style="color:red" />
							<h:outputLabel
								rendered="#{editArticleBean.articleAllowEdit and editArticleBean.selectedArticle.audioUrls.size()>0}" />
							<h:panelGrid columns="2" rendered="#{editArticleBean.articleAllowEdit}"
								columnClasses="mediaResourceTableColumnContent, mediaResourceTableColumnButton"
								width="100%">
								<h:inputText id="audioInput" required="true"
									styleClass="textInputMaxWidth"
									value="#{editArticleBean.newAudioUrl}">
									<f:validator validatorId="mediaUrlValidator" />
								</h:inputText>
								<h:commandLink value="#{msg['page.label.add']}"
									action="#{editArticleBean.addAudio}">
									<f:ajax execute="audioInput" render="audioInputContainer" />
								</h:commandLink>
							</h:panelGrid>
							<h:message for="audioInput" rendered="#{editArticleBean.articleAllowEdit}" style="color:red" />
						</h:panelGrid>

						<h:panelGrid id="formErrors" width="100%" columns="1"
							columnClasses="alignRight">
							<h:messages for="mainForm" style="color:red" />
						</h:panelGrid>

						<h:panelGrid width="100%" columns="6"
							columnClasses="featureTableActionColumn,featureTableActionColumn,featureTableActionColumn,featureTableActionColumn">
							<h:commandButton styleClass="featureActionButton"
								rendered="#{editArticleBean.articleStatusReviewed and editArticleBean.userChiefEditor}"
								value="#{msg['page.label.publish']}"
								action="#{editArticleBean.moveArticle(true)}">
								<f:ajax
									execute="subjectInput shortDescriptionInput categoryInput contentInput"
									render="articleDetailsContainer contentInputContainer" />
							</h:commandButton>
							<h:commandButton styleClass="featureActionButton"
								rendered="#{editArticleBean.articleStatusPosted and editArticleBean.userChiefEditor}"							
								value="#{msg['page.label.review']}"
								action="#{editArticleBean.moveArticle(true)}">
								<f:ajax
									execute="subjectInput shortDescriptionInput categoryInput contentInput"
									render="articleDetailsContainer contentInputContainer" />
							</h:commandButton>		
							<h:commandButton styleClass="featureActionButton"
								rendered="#{editArticleBean.articleStatusCreated and editArticleBean.articleOwnedByUser}"							
								value="#{msg['page.label.post']}"
								action="#{editArticleBean.moveArticle(true)}">
								<f:ajax
									execute="subjectInput shortDescriptionInput categoryInput contentInput"
									render="articleDetailsContainer contentInputContainer" />
							</h:commandButton>																											
							<h:commandButton styleClass="featureActionButton"
								rendered="#{editArticleBean.articleAllowSave}"														
								value="#{msg['page.label.save']}"
								action="#{editArticleBean.saveArticle()}">
								<f:ajax
									execute="subjectInput shortDescriptionInput categoryInput contentInput"
									render="articleDetailsContainer contentInputContainer" />
							</h:commandButton>
							<h:commandButton styleClass="featureActionButton"
								rendered="#{editArticleBean.articleAllowEdit}"																					
								value="#{msg['page.label.reset']}">
								<f:ajax listener="#{editArticleBean.reloadArticle}"
									process="@this" render="featureDetails" />
							</h:commandButton>
						</h:panelGrid>

						<h:panelGrid width="100%" style="height:50px;" />

					</h:panelGroup>

				</h:panelGroup>

			</h:panelGroup>

		</h:panelGroup>

	</ui:define>

	<ui:define name="javaScriptContent">

		<script type="text/javascript">
	   		var initEditor = ( function() {
	   			var element =  document.getElementById('mainForm:contentValue');
	   			if (element != null){
			   		var editor =  CKEDITOR.replace('mainForm:contentValue',
				         {
				         });
				     editor.on( 'change', function( evt ) {
				    	 document.getElementById('mainForm:contentInput').value = evt.editor.getData();
			    	}); 		
	   			}
	   		} )();
		</script>

	</ui:define>

</ui:composition>

